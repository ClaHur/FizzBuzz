const prompt = require('prompt-sync')();

//Function to add a rule
const addRule = function () {
    var num, rule, word = "";
    //User selects number to apply rule to
    while (!Number.isInteger(num)) {
        num = prompt('What number would you like to apply a rule to? ');
        num = parseFloat(num);
        if (!Number.isInteger(num)) {
            console.log("Invalid input, please try again.")
        }
    }
    //User selects rule to apply
    while (!["APPEND", "REPLACE", "REVERSE"].includes(rule)) {
        rule = prompt('What rule would you like to apply (APPEND,REPLACE,REVERSE)? ');
        if (!["APPEND", "REPLACE", "REVERSE"].includes(rule)) {
            console.log("Invalid input, please try again.")
        }
    }
    //For 'append' and 'replace' rules, user chooses word to use
    if (["APPEND", "REPLACE"].includes(rule)) {
        while (word.length !== 4) {
            word = prompt('What four letter word would you like to use with your rule? ');
            if (word.length !== 4) {
                console.log("Invalid input, please try again.")
            }
        }
    }
    return [num, rule, word];
}

//Function to allow user to choose rules
var chooseRules=function() {
    var applyRules = "Y", rules = [];
    while (applyRules == "Y") {
        rules.push(addRule()); //Add rule using function from stretchFunc file
        applyRules = prompt('Would you like to apply another rule? (Y/N) ');
    }
    return rules;
}


//Function to apply a rule to a number
const runRule = function (log,rules,i, j) {
    useNum = rules[j][0];
    useRule = rules[j][1];
    useWord = rules[j][2];
    if (i % useNum == 0) {
        switch(useRule){
            case "APPEND":
                log += useWord; //append user's choice of word to the log value
                break;
            case "REPLACE":
                log = useWord; //replace the log value with the user's choice of word
                break;
            case "REVERSE":
                log = log.match(/.{0,4}/g).reverse().join(""); //reverse the words in the log value
                break;
        }
        }
    return log;
}

//Function to run the fizzbuzzer
const runFizzBuzz=function(rules,max) {
    var log;
    for (var i = 1; i <= max; i++) { //Log until hitting user's maximum number
        log = "";
        var useNum, useRule, useWord;
        for (var j = 0; j < rules.length; j++) {
            log = runRule(log, rules, i, j); //For each number, check and apply each rule provided using function from stretchFunc file
        }
        log.length > 1 ? console.log(log) : console.log(i); //Log the generated string, or the number if no rules apply
    }
}

const wait= function(string,time){
    setTimeout(function(){console.log(string);},time);
}

module.exports = {addRule, chooseRules, runRule, runFizzBuzz, wait}; //export functions to main file